(function(){window.boneVojage=function(o,t){return window.boneVojage_main={settings:{$body:$("body"),$window:$(window),$document:$(document),$body_html:$("body,html"),currPoint:0,tryPositionCount:0,points:[],$modalTop:0,$modalBottom:0,$modalLeft:0,$modalRight:0,$tooltip:0},options:{delay:1e3,offset:4,positionPriority:["bottom","top","left","right","bottom_left","bottom_right","top_left","top_right"],position:"best",button_next:39,button_prev:37,map:!0,buttons:!0},constructor:function(o){var t;t=boneVojage_main.options.buttons?'<div id="buttons"><div id="prev">prev</div><div id="next">next</div></div>':"";var e=$("div#modal_top"),n=$("div#modal_bottom"),i=$("div#modal_left"),s=$("div#modal_right"),a=$("div#tooltip");return e||boneVojage_main.settings.$body.append('<div id="modal_top"></div>'),n||boneVojage_main.settings.$body.append('<div id="modal_bottom"></div>'),i||boneVojage_main.settings.$body.append('<div id="modal_left"></div>'),s||boneVojage_main.settings.$body.append('<div id="modal_right"></div>'),a||boneVojage_main.settings.$body.append('<div id="tooltip"><div id="close"></div><div id="title"></div><div id="text"></div>'+t+"<ul></ul></div>"),boneVojage_main.settings.$modalTop=$("div#modal_top"),boneVojage_main.settings.$modalBottom=$("div#modal_bottom"),boneVojage_main.settings.$modalLeft=$("div#modal_left"),boneVojage_main.settings.$modalRight=$("div#modal_right"),boneVojage_main.settings.$tooltip=$("div#tooltip"),boneVojage_main.settings.points=o,boneVojage_main.settings.scrollBeforeVojageY=boneVojage_main.settings.$window.scrollTop(),boneVojage_main.settings.scrollBeforeVojageX=boneVojage_main.settings.$window.scrollLeft(),boneVojage_main.options.map&&boneVojage_main.O.makeMap(),boneVojage_main.O.makeModalPosition(o[boneVojage_main.settings.currPoint].selector,boneVojage_main.options.offset).done(function(){return boneVojage_main.O.showModal()}),boneVojage_main.E.listen()},E:{listen:function(){return boneVojage_main.settings.$document.on("keyup",function(o){switch(o.keyCode){case parseInt(boneVojage_main.options.button_next,10):if(boneVojage_main.settings.currPoint<boneVojage_main.settings.points.length-1)return boneVojage_main.O.next();break;case parseInt(boneVojage_main.options.button_prev,10):if(boneVojage_main.settings.currPoint>0)return boneVojage_main.O.prev()}}),boneVojage_main.settings.$tooltip.on("click","#next",function(){return boneVojage_main.O.next()}).on("click","#prev",function(){return boneVojage_main.O.prev()}).on("click","#close",function(){return boneVojage_main.settings.tryPositionCount=0,boneVojage_main.O.hideModal(),boneVojage_main.settings.$body_html.animate({scrollTop:boneVojage_main.settings.scrollBeforeVojageY,scrollLeft:boneVojage_main.settings.scrollBeforeVojageX},boneVojage_main.options.delay)}).on("click","li",boneVojage_main.O.makeVojageProgress)}},O:{makeMap:function(){var t,e,n;for(e="",t=0,n=o.length-1;n>=0?n>=t:t>=n;n>=0?t++:t--)e+="<li></li>";return boneVojage_main.settings.$tooltip.find("ul").html(e)},makeVojageProgress:function(){return boneVojage_main.settings.tryPositionCount=0,boneVojage_main.settings.currPoint=$(this).index(),boneVojage_main.O.makeModalPosition(boneVojage_main.settings.points[boneVojage_main.settings.currPoint].selector,boneVojage_main.options.offset).done(function(){return boneVojage_main.O.showModal()})},next:function(){var o=++boneVojage_main.settings.currPoint,t=boneVojage_main.settings.points[o].beforeModal,e=boneVojage_main.settings.points[o].afterModal;return t?t():null,boneVojage_main.settings.tryPositionCount=0,boneVojage_main.O.makeModalPosition(boneVojage_main.settings.points[o].selector,boneVojage_main.options.offset).done(function(){var o=boneVojage_main.O.showModal();return e?e():null,o})},prev:function(){var o=--boneVojage_main.settings.currPoint,t=boneVojage_main.settings.points[o].beforeModal,e=boneVojage_main.settings.points[o].afterModal;return t?t():null,boneVojage_main.settings.tryPositionCount=0,boneVojage_main.O.makeModalPosition(boneVojage_main.settings.points[o].selector,boneVojage_main.options.offset).done(function(){var o=boneVojage_main.O.showModal();return e?e():null,o})},getGSides:function(o){var t,e;return e=boneVojage_main.settings.$tooltip.outerWidth()>o.outerWidth()?o.offset().left+o.outerWidth()+Math.abs(o.outerWidth()-boneVojage_main.settings.$tooltip.outerWidth())/2:o.offset().left+o.outerWidth(),t=boneVojage_main.settings.$tooltip.outerWidth()>o.outerWidth()?o.offset().left-Math.abs(o.outerWidth()-boneVojage_main.settings.$tooltip.outerWidth())/2:o.offset().left,{g_right:e,g_left:t}},makeTooltipPosition:function(o,t,e){var n,i;switch(i=boneVojage_main.O.getPosition(t),boneVojage_main.settings.$tooltip.css({position:i.fixed}),"best"!==o&&(boneVojage_main.settings.$tooltip.attr("class",""),boneVojage_main.settings.$tooltip.addClass(o)),o){case"left":boneVojage_main.settings.$tooltip.css({top:t.offset().top-boneVojage_main.settings.$tooltip.outerHeight()/2+t.outerHeight()/2-i.normH,left:t.offset().left-boneVojage_main.settings.$tooltip.outerWidth()-e-i.normY});break;case"right":boneVojage_main.settings.$tooltip.css({top:t.offset().top-boneVojage_main.settings.$tooltip.outerHeight()/2+t.outerHeight()/2-i.normH,left:t.offset().left+t.outerWidth()+e-i.normY});break;case"top":boneVojage_main.settings.$tooltip.css({top:t.offset().top-boneVojage_main.settings.$tooltip.outerHeight()-e-7-i.normH,left:t.offset().left+t.outerWidth()/2-boneVojage_main.settings.$tooltip.outerWidth()/2-i.normY});break;case"top_left":boneVojage_main.settings.$tooltip.css({top:t.offset().top-boneVojage_main.settings.$tooltip.outerHeight()-7-i.normH,left:t.offset().left-boneVojage_main.settings.$tooltip.outerWidth()-i.normY});break;case"top_right":boneVojage_main.settings.$tooltip.css({top:t.offset().top-boneVojage_main.settings.$tooltip.outerHeight()-7-i.normH,left:t.offset().left+t.outerWidth()-i.normY});break;case"bottom":boneVojage_main.settings.$tooltip.css({top:t.offset().top+t.outerHeight()+e-i.normH,left:t.offset().left+t.outerWidth()/2-boneVojage_main.settings.$tooltip.outerWidth()/2-i.normY});break;case"bottom_right":boneVojage_main.settings.$tooltip.css({top:t.offset().top+t.outerHeight()-i.normH,left:t.outerWidth()+t.offset().left-i.normY});break;case"bottom_left":boneVojage_main.settings.$tooltip.css({top:t.offset().top+t.outerHeight()-i.normH,left:t.offset().left-boneVojage_main.settings.$tooltip.outerWidth()-i.normY});break;case"best":n=boneVojage_main.settings.tryPositionCount++,n<boneVojage_main.options.positionPriority.length?boneVojage_main.O.makeTooltipPosition(boneVojage_main.O.tryPosition[boneVojage_main.options.positionPriority[n]](t,boneVojage_main.options.offset),t,boneVojage_main.options.offset):boneVojage_main.O.makeTooltipPosition(boneVojage_main.options.positionPriority[0],t,boneVojage_main.options.offset)}return t},tryPosition:{left:function(o,t){return o.offset().left-boneVojage_main.settings.$tooltip.outerWidth()-t>boneVojage_main.settings.$window.scrollLeft()&&o.offset().top-Math.abs(o.outerHeight()-boneVojage_main.settings.$tooltip.outerHeight())/2>boneVojage_main.settings.$window.scrollTop()&&o.offset().top+Math.abs(o.outerHeight()-boneVojage_main.settings.$tooltip.outerHeight())/2<boneVojage_main.settings.$window.scrollTop()+boneVojage_main.settings.$window.outerHeight()?"left":"best"},right:function(o,t){return o.offset().left+o.outerWidth()+t<boneVojage_main.settings.$window.scrollLeft()+boneVojage_main.settings.$window.outerWidth()&&o.offset().top-Math.abs(o.outerHeight()-boneVojage_main.settings.$tooltip.outerHeight())/2>boneVojage_main.settings.$window.scrollTop()&&o.offset().top+Math.abs(o.outerHeight()-boneVojage_main.settings.$tooltip.outerHeight())/2<boneVojage_main.settings.$window.scrollTop()+boneVojage_main.settings.$window.outerHeight()?"right":"best"},top:function(o,t){var e;return e=boneVojage_main.O.getGSides(o),o.offset().top-t-boneVojage_main.settings.$tooltip.outerHeight()>boneVojage_main.settings.$window.scrollTop()&&e.g_left>boneVojage_main.settings.$window.scrollLeft()&&e.g_right<boneVojage_main.settings.$window.outerWidth()+boneVojage_main.settings.$window.scrollLeft()?"top":"best"},top_left:function(o,t){return o.offset().top-boneVojage_main.settings.$tooltip.outerHeight()-t-boneVojage_main.settings.$tooltip.outerHeight()>boneVojage_main.settings.$window.scrollTop()&&o.offset().left-boneVojage_main.settings.$tooltip.outerWidth()>boneVojage_main.settings.$window.scrollLeft()?"top_left":"best"},top_right:function(o,t){return o.offset().top-boneVojage_main.settings.$tooltip.outerHeight()-t-boneVojage_main.settings.$tooltip.outerHeight()>boneVojage_main.settings.$window.scrollTop()&&o.offset().left+o.outerWidth()+boneVojage_main.settings.$tooltip.outerWidth()<boneVojage_main.settings.$window.scrollLeft()+boneVojage_main.settings.$window.outerWidth()?"top_right":"best"},bottom:function(o,t){var e;return e=boneVojage_main.O.getGSides(o),o.offset().top+o.outerHeight()+t+boneVojage_main.settings.$tooltip.outerHeight()<boneVojage_main.settings.$window.scrollTop()+boneVojage_main.settings.$window.outerHeight()&&e.g_left>boneVojage_main.settings.$window.scrollLeft()&&e.g_right<boneVojage_main.settings.$window.scrollLeft()+boneVojage_main.settings.$window.outerWidth()?"bottom":"best"},bottom_left:function(o,t){return o.offset().top+o.outerHeight()+t+boneVojage_main.settings.$tooltip.outerHeight()<boneVojage_main.settings.$window.scrollTop()+boneVojage_main.settings.$window.outerHeight()&&o.offset().left-boneVojage_main.settings.$tooltip.outerWidth()>boneVojage_main.settings.$window.scrollLeft()?"bottom_left":"best"},bottom_right:function(o,t){return o.offset().top+o.outerHeight()+t+boneVojage_main.settings.$tooltip.outerHeight()<boneVojage_main.settings.$window.scrollTop()+boneVojage_main.settings.$window.outerHeight()&&o.offset().left+o.outerWidth()+boneVojage_main.settings.$tooltip.outerWidth()<boneVojage_main.settings.$window.scrollLeft()+boneVojage_main.settings.$window.outerWidth()?"bottom_right":"best"}},showModal:function(){return boneVojage_main.settings.$modalTop.fadeIn(),boneVojage_main.settings.$modalBottom.fadeIn(),boneVojage_main.settings.$modalLeft.fadeIn(),boneVojage_main.settings.$modalRight.fadeIn(),boneVojage_main.settings.$tooltip.fadeIn()},addControls:function(){return boneVojage_main.settings.currPoint<boneVojage_main.settings.points.length-1&&boneVojage_main.settings.$tooltip.find("#next").show(),boneVojage_main.settings.currPoint>0?boneVojage_main.settings.$tooltip.find("#prev").show():void 0},hideModal:function(){return boneVojage_main.settings.$tooltip.find("#next,#prev").hide(),boneVojage_main.settings.$tooltip.hide(),boneVojage_main.settings.$modalTop.hide(),boneVojage_main.settings.$modalBottom.hide(),boneVojage_main.settings.$modalLeft.hide(),boneVojage_main.settings.$modalRight.hide()},getPosition:function(o){var t,e,n,i,s;return t=o.css("position"),n=o.offset().top-boneVojage_main.settings.$window.outerHeight()/2,i=o.offset().left-boneVojage_main.settings.$window.outerWidth()/2,e=0,s=0,"fixed"!==t?t="absolute":(n=boneVojage_main.settings.$window.scrollTop(),i=boneVojage_main.settings.$window.scrollLeft(),e=boneVojage_main.settings.$window.scrollTop(),s=boneVojage_main.settings.$window.scrollLeft()),{fixed:t,normH:e,normY:s,normScrollH:n,normScrollY:i}},waitForSelector:function(o,t){var e,t;return t||(t=$.Deferred()),e=$(o),e.length>0?t.resolve(e):setTimeout(boneVojage_main.O.waitForSelector(o,t),500),t.promise()},makeModalPosition:function(o){var t,e,n,i;return e=$.Deferred(),t=0,i=boneVojage_main.options.offset,boneVojage_main.O.waitForSelector(o).done(function(o){n=boneVojage_main.O.getPosition(o),boneVojage_main.O.hideModal(),boneVojage_main.settings.$tooltip.find("li").eq(boneVojage_main.settings.currPoint).addClass("active").siblings().removeClass("active"),boneVojage_main.settings.$body_html.stop(!0,!1).animate({scrollTop:n.normScrollH,scrollLeft:n.normScrollY},boneVojage_main.options.delay,function(){return 0===t++?(e.resolve(),boneVojage_main.settings.$modalTop.css({position:n.fixed,height:o.offset().top-i-n.normH,width:o.outerWidth()+2*i,left:o.offset().left-i-n.normY}),boneVojage_main.settings.$modalBottom.css({position:n.fixed,height:$(document).outerHeight()-o.offset().top-o.outerHeight()-i+n.normY,width:o.outerWidth()+2*i,left:o.offset().left-i-n.normY,top:o.offset().top+o.outerHeight()+i-n.normH}),boneVojage_main.settings.$modalLeft.css({position:n.fixed,width:boneVojage_main.settings.$body.outerWidth()-(boneVojage_main.settings.$body.outerWidth()-o.offset().left)-i-n.normY,height:$(document).outerHeight()-n.normH}),boneVojage_main.settings.$modalRight.css({position:n.fixed,left:o.offset().left+o.outerWidth()+i-n.normY,height:$(document).outerHeight()-n.normH,width:boneVojage_main.settings.$body.outerWidth()-(o.offset().left+o.outerWidth())-i}),boneVojage_main.settings.$tooltip.find("#text").text(boneVojage_main.settings.points[boneVojage_main.settings.currPoint].text),boneVojage_main.settings.$tooltip.find("#title").text(boneVojage_main.settings.points[boneVojage_main.settings.currPoint].title),boneVojage_main.O.addControls(),boneVojage_main.O.makeTooltipPosition(boneVojage_main.options.position,o,i)):void 0})}),e.promise()}}},boneVojage_main.options=$.extend({},boneVojage_main.options,t||{}),boneVojage_main.constructor(o)}}).call(this);
